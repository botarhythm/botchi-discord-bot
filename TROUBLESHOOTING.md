# ボッチー Discord Bot トラブルシューティングガイド 🛠️

このガイドは、Bocchy Botのバージョン1.2.0（コンテキスト管理機能追加版）で発生する可能性のある問題を解決するためのものです。

## ボットが応答しなくなった場合 🤖

### 問題1: 初期化の順序問題

v1.2.0では、AIサービスとコンテキスト管理モジュールの正しい初期化順序が重要になりました。初期化が完了する前にメッセージ処理が始まると、ボットが応答しなくなる可能性があります。

#### 解決策:

1. **ホットフィックスを使用**: リポジトリに含まれるホットフィックススクリプトを実行します
   ```bash
   node hotfix-initialization.js
   ```
   
2. **手動で初期化**: 初期化が成功したら、ボットを通常通り起動します
   ```bash
   npm start
   ```

### 問題2: Supabase接続の問題

Supabase設定が正しくない、またはSupabaseサーバーに接続できない場合、ボットの動作に影響する可能性があります。

#### 解決策:

1. **メモリのみモードを使用**: Supabaseを使用せず、メモリ内キャッシュのみで動作するようにします
   ```bash
   node hotfix-memory-only.js
   ```
   
2. **環境変数を確認**: `.env`ファイルで以下の設定を確認します
   ```
   SUPABASE_URL=your_supabase_url
   SUPABASE_KEY=your_supabase_key
   ```

3. **Supabaseプロジェクトの確認**: Supabaseダッシュボードでテーブルが正しく作成されているか確認します

### 問題3: API接続の問題

OpenAI APIに接続できない場合、ボットは応答できなくなります。

#### 解決策:

1. **APIキーを確認**: `.env`ファイルで以下の設定を確認します
   ```
   OPENAI_API_KEY=your_openai_api_key
   ```

2. **ヘルスチェック**: APIの状態を確認します
   ```bash
   npm run health
   ```

3. **デバッグモードを有効化**: `.env`ファイルで`DEBUG=true`を設定します

## デバッグとログ確認 🔍

### デバッグヘルパーの使用

ボットの状態を詳細に調査するには、デバッグヘルパースクリプトを実行します：

```bash
node debug-helper.js
```

これにより、以下の情報が表示されます：
- コンテキストマネージャーの設定と接続状態
- OpenAIサービスの設定と接続状態
- 環境変数の設定状況

### ログファイルの作成

ボットの出力を詳細に記録するには、以下のコマンドを使用します：

```bash
npm start > bot-log.txt 2>&1
```

### 一般的なトラブルシューティング手順

1. **依存関係の再インストール**:
   ```bash
   npm ci
   ```

2. **キャッシュのクリア**:
   ```bash
   rm -rf node_modules/.cache
   ```

3. **Railway環境での確認**:
   - Railwayダッシュボードでログを確認
   - 環境変数が正しく設定されているか確認
   - サービスの再デプロイを試みる

## バージョンロールバック 🔄

問題が解決しない場合は、以前のバージョンに戻すことも検討してください：

```bash
git checkout v1.1.0
npm install
npm start
```

## サポートとフィードバック 🌱

問題が続く場合は、以下の情報を添えてGitHubの[Issues](https://github.com/botarhythm/botchi-discord-bot/issues)に問題を報告してください：

1. `debug-helper.js`の出力結果
2. 発生した問題の詳細な説明
3. 実行環境（Node.jsバージョン、OS情報など）

---

*もし森の奥の案内人が見つからなくても、風は途切れることなく、葉は揺れ続けるもの。  
しばらく待てば、またその姿を見せてくれるでしょう。*